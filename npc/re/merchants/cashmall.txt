//===== rAthena Script ======================================= 
//= Cash Mall
//===== Changelogs: ==========================================
//= 1.0 Initial version from replays. [Lemongrass]
//============================================================

prontera,137,125,4	script	Cash Sales Guide#prontera::cashmall_warper	4_M_HUMAN_02,{
	mes "[Guide]";
	mes "Hello~";
	mes "This guide wants to be the one to take you to a special place.";
	mes "What kind of place is that?";
	next;
	mes "[Guide]";
	mes "It's a place full of mysterious items to collect and sell.";
	mes "To buy stuff there you need special money.";
	next;
	mes "[Guide]";
	mes "So, are you ready to go there?";
	next;
	switch( select( "Yes", "No" )) {
		case 1:
			mes "[Guide]";
			mes "Yeah~ You're really ready.";
			mes "Well then, get some good stuff~";
			mes "Oops, I forgot. When you come out be sure to come back here.";
			mes "Rember this~";
			close2;
			setarray .@maparray$[0], "prontera", "morocc", "moc_ruins", "geffen", "payon", "lighthalzen", "rachel";
			.@return = inarray(.@maparray$[0], strcharinfo(3));

			if (.@return >= 0)
				cashmall_return = .@return + 1;
			else // Default to Prontera if not found
				cashmall_return = 1;

			warp "itemmall",22,43;
			end;
		case 2:
			
			mes "[Guide]";
			mes "Okay~";
			mes "But don't get frustrated.";
			mes "There's always more chances~";
			close;
	}
}

// TODO: find duplicates in other cities

itemmall,21,45,4	script	Exit Guide#cashmall_exit	4_M_HUMAN_02,{
	mes "[Guide]";
	mes "Have you had a good time?";
	mes "Thank you very much for using our item mall.";
	mes "We will continue to bring you valuable items.";
	next;
	mes "[Guide]";
	mes "Would you like to return from where you came from?";
	next;
	switch( select( "Yes", "No" )) {
		case 1:
			mes "[Guide]";
			mes "Thank you for coming.";
			mes "I'll send you back from where you came from.";
			close2;
			switch(cashmall_return) {
				default:
				case 1:
					.@returnmap$ = "prontera";
					setarray .@xy[0],116,72;
					break;
				case 2:
					.@returnmap$ = "morocc";
					setarray .@xy[0],159,46;
					break;
				case 3:
					.@returnmap$ = "moc_ruins";
					setarray .@xy[0],109,137;
					break;
				case 4:
					.@returnmap$ = "geffen";
					setarray .@xy[0],120,38;
					break;
				case 5:
					.@returnmap$ = "payon";
					setarray .@xy[0],161,58;
					break;
				case 6:
					.@returnmap$ = "lighthalzen";
					setarray .@xy[0],159,95;
					break;
				case 7:
					.@returnmap$ = "rachel";
					setarray .@xy[0],115,125;
					break;
			}
			cashmall_return = 0;
			warp .@returnmap$,.@xy[0],.@xy[1];
			end;
		case 2:
			mes "[Guide]";
			mes "There are still more things to see.";
			mes "Have a good time.";
			close;
	}
}

itemmall,41,53,3	script	Cat Hand Salesman Macaroon#cashmall	4_M_MERCAT1,{
	mes "[Macaroon]";
	mes "Welcome!";
	mes "Today doesn't come every day!";
	mes "Things to see today~ Voila!";
	mes "You can only exchange with <ITEM>[[Kachua] Mileage Coupon]<INFO>1000274</INFO></ITEM>!";
	mes "Feel free to choose!";
	next;
	switch( select( "3-1st Job Group Skill Shadow", "3-2nd Job Group Skill Shadow", "Extended Job Group Skill Shadow", "General Shadow by Occupation", "Shadow Cube", "Smelting, Modification, Useful Items", "Drop Box", "Spellbook" ) ){
		case 1:
			mes "[Macaroon]";
			mes "^FF00663-1st Job Group Skill Shadow^000000 you say!";
			mes "Here they are!";
			close2;
			callshop "CachuaCoupon01";
			end;

		case 2:
			mes "[Macaroon]";
			mes "^FF00663-2nd Job Group Skill Shadow^000000 you say!";
			mes "Here they are!";
			close2;
			callshop "CachuaCoupon02";
			end;

		case 3:
			mes "[Macaroon]";
			mes "^FF0066Extended Job Group Skill Shadow^000000 you say!";
			mes "Here they are!";
			close2;
			callshop "CachuaCoupon03";
			end;

		case 4:
			mes "[Macaroon]";
			mes "^FF0066General Shadow by Occupation^000000 you say!";
			mes "Here they are!";
			close2;
			callshop "CachuaCoupon04";
			end;

		case 5:
			mes "[Macaroon]";
			mes "^FF0066Shadow Cube^000000 you say!";
			mes "Here they are!";
			close2;
			callshop "CachuaCoupon05";
			end;

		case 6:
			mes "[Macaroon]";
			mes "^FF0066Smelting, Modification, Useful Items^000000 you say!";
			mes "Here they are!";
			close2;
			callshop "CachuaCoupon06";
			end;

		case 7:
			mes "[Macaroon]";
			mes "^FF0066Drop Box^000000 you say!";
			mes "Here they are!";
			close2;
			callshop "CachuaCoupon07";
			end;

		case 8:
			mes "[Macaroon]";
			mes "^FF0066Spellbook^000000 you say!";
			mes "Here they are!";
			close2;
			callshop "CachuaCoupon08";
			end;
	}
}

morocc,164,39,4	duplicate(cashmall_warper)	Cash Sales Guide#morocc	899
moc_ruins,115,143,4	duplicate(cashmall_warper)	Cash Sales Guide#moc_ruins	899
geffen,115,168,4	duplicate(cashmall_warper)	Cash Sales Guide#geffen	899
payon,164,157,4	duplicate(cashmall_warper)	Cash Sales Guide#payon	899
lighthalzen,206,144,4	duplicate(cashmall_warper)	Cash Sales Guide#lighthalzen	899
rachel,128,144,4	duplicate(cashmall_warper)	Cash Sales Guide#rachel	899

itemmall,24,77,4	script	Blacksmith Basta#pr	4_M_DWARF,{
	if( !getbattleflag( "feature.refineui" ) ){
		end;
	}

	mes "[Blacksmith Basta]";
	mes "I have taken over the work of Mighty Hammer, Brock and the Shadow Blacksmith. I will be busy from now on.";
	close2;
	refineui();
	end;
}

itemmall,27,77,4	script	Mighty Hammer#im	4_M_DWARF,{
	mes "[Blacksmith Mighty Hammer]";
	mes "If it is about refining, ask Basta. I am retired.";
	close;
}

itemmall,24,74,5	script	Blacksmith Brock#im	4_M_HUMAN_01,{
	mes "[Blacksmith Brock]";
	mes "I am retired now. If it is about refining, make a request to Basta over there.";
	close;
}
